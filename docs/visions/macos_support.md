# macOS Support Vision

azooKey for macOSに向けたVision Documentです。

## IMKit

macOSでIMEを作るにはIMKitを利用します。ほとんど最小構成のIMEを動かすためのサンプルは以下のレポジトリで用意しています。

https://github.com/ensan-hcl/macOS_IMKitSample_2021

この中で`inputText`という関数がありますが、これが「キーを押したときに文字を入力する」という操作の根幹にある処理です。この処理を複雑にしていくことで日本語入力のIMEが実現できると考えられます。

## かな漢字変換処理のモジュール化

azooKeyの変換処理は現状独立したモジュールになっていません。macOSサポートにあたり、まずazooKeyの変換器を独立したモジュールとして再構築する必要があります。

この手続きはそこまで難しくありません。変換モジュールを独立させる変更のテストはすでに実施済みです。ただ、処理性能において無視できない劣化が見られるため、原因を調査する必要が生じています。

変換器をモジュール化したあとは、azooKey for macOSのターゲットを既存のプロジェクトに追加します。

## 文節単位変換などの実装

現在のazooKeyはスマートフォン向けをメインに設計しているため、「文節単位変換」といったデスクトップIMEの基本的な機能が未実装となっています。このため、Converterのモジュール化のあと、内部処理に大きく変更を加える必要が生じる可能性があります。

このほか以下のような作業も必要になります。

* 誤り訂正の無効化（デスクトップ向けのIMEでは誤り訂正は使われないことが多いです）
* ライブ変換の調整

## 設定UIの実装

azooKeyはスマートフォン向けのUIオプションを数多く提供していますが、macOS向けに引き継げるものは「変換関連の設定」「ユーザ辞書」「テンプレート」「学習機能」程度です。これらの設定を切り替えるためのGUIが必要です。

