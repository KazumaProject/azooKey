# Emoji and Kaomoji Policy

## 絵文字と顔文字の分離

azooKeyでは絵文字と顔文字の分離を行っています。「絵文字をもっぱら用いる人」「顔文字をもっぱら用いる人」「区別なく用いる人」がいるためです。

上記の分離を実現するため、絵文字と顔文字は本体辞書としてはバンドルされず、ユーザ辞書と共にビルドされ、キーボード上で用いられています。

## 絵文字の更新

絵文字はUnicodeによっておおよそ1年間隔で更新が実施されます。このため、アプリケーションも1年間隔でデータを修正する必要があります。また、iOS / iPadOSでは絵文字の追加がOSの更新に伴って実施されます。

azooKeyの絵文字データは`MainApp/DataSet`の位置にバージョン別に保存されています。Dictファイルはtsvで、次のような構造を持ちます。

```tsv
ルビ	絵文字	左品詞ID	右品詞ID	意味ID	コスト
```

ただし、現状は常に以下の形で固定しています。

```
ルビ	絵文字	5	5	501	-20
```

このデータをSwift側で読み込み、OSバージョンに応じてどこまで追加するかを判断し、ユーザ辞書とともに辞書ファイルとしてビルドし、保存します。

このため、iOS / iPadOSの更新直後すぐに新しい絵文字が使えるようにはならず、一度本体アプリを開いて辞書ファイルの再ビルドを行う必要があります。これを促すため、絵文字の更新と共にMessageViewをキーボード上に表示します。

## 絵文字タブ

Version 2.1で絵文字タブを実装しました。これはiOS標準の絵文字キーボードを概ね模したものであり、キーボード内でシームレスに利用できる点が利点となっています。

独自の機能としては、絵文字の倍率変更が可能です。これは小さな文字が見づらい人向けの機能で、キーの表示がより大きくなるため、快適に絵文字を探せるようになります。

### ユーザ設定

絵文字タブでは、ユーザの履歴に基づいて3つの最適化が実施されます。

1. 肌の色バリエーションの記憶

Skin Tone Modifierによって複数のバリエーションが存在する絵文字があります。例えば👍👍🏻👍🏼👍🏽👍🏾👍🏿のようなものです。これらはデフォルトの状態ではModifierのつかないバージョンを表示しますが、一度Modifierがついたバージョンを選ぶとそれ以降はそれをキーに表示します。

2. よく使う絵文字

絵文字の入力履歴に基づき、「よく使う絵文字」の記録を保存します。これは単なる「最近使った絵文字」ではなく、使用頻度に基づいてある程度のランキングを行っています。

3. 倍率の記録

ユーザが画面右下のキーで倍率を変更すると、変更した倍率が記録され、次回開いたときもその倍率が維持されます。

なお、これらの最適化はすべてキーボードの内部領域に保存され、コンテナアプリケーションからは不可視になっています。

#### 考えられる改善事項

* 「肌の色のデフォルト設定」のような機能を作ることができます。
* 「よく使う絵文字」をピン留めしておくことができます。これによって、好みの絵文字の入力が簡単になります。
* 倍率を縦持ち・横持ちで別々に設定できるようになると便利になるかもしれません。

### データ

絵文字タブで表示する絵文字のデータは、`Gen/scripts/emoji.py`によってUnicodeバージョンごとにビルド時に自動生成されています。元にするデータはUnicode / CLDRのデータとMozcの絵文字辞書データと独自に追加したエントリです。

#### 考えられる改善事項

* 絵文字辞書は`MainApp/DataSet`内に保存されていますが、こちらについても同様に自動生成に変更することを予定しています。

### TextReplacer

`TextReplacer`は絵文字タブのバリエーションを表示したり、検索を行ったりするためのAPIです。

### CustardKit API

現在、絵文字タブはSwiftUIによって実装されていて、CustardKitのAPIを利用していません。このため、ユーザが絵文字タブのような新しいタブを自作することはできません。

#### 考えられる改善事項

* 適切に規格を定めることで、絵文字タブに近いカスタムタブを作ることができるようになるかもしれません。現在実装の予定はありませんが、需要がありそうならば検討していきます。

